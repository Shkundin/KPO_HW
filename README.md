# Учет финансов — консольное приложение (C#/.NET)

Консольное приложение для управления личными финансами: счета, категории, операции (доходы/расходы), простая аналитика и экспорт. Данные сохраняются в локальную папку `./data` рядом с исполняемым файлом.

## Содержание
- [Возможности](#возможности)
- [Структура и хранение данных](#структура-и-хранение-данных)
- [Требования](#требования)
- [Сборка и запуск](#сборка-и-запуск)
- [Меню приложения](#меню-приложения)
- [Экспорт данных](#экспорт-данных)
- [Служебные действия](#служебные-действия)
- [Советы по проверке](#советы-по-проверке)
- [Лицензия](#лицензия)
- [Использованные паттерны и DI](#использованные-паттерны-и-di)

---

## Возможности

- **Счета:** хранение набора счетов с балансами.  
- **Категории:** два типа — *Доход* и *Расход*.  
- **Операции:**
  - Добавление **дохода** в выбранный счёт и категорию.
  - Добавление **расхода** в выбранный счёт и категорию.
  - **Перевод** между счетами (как расход со счёта-источника и доход на счёт-получатель).
  - **Редактирование** существующей операции (за последние 30 дней).
- **Аналитика:**
  - Сводка **Доход / Расход / Нетто** за произвольный период.
  - Группировка сумм **по категориям** за период.
- **Экспорт** всех данных (счета, категории, операции) в **CSV / JSON / YAML**.
- **Формат сумм** переключаемый: `₽` или `N2 RUB`.

Все действия доступны из текстового меню в консоли.

---

## Структура и хранение данных

- Файловое JSON-хранилище в папке **`./data`** (создаётся автоматически при первом запуске).  
- Если данных нет, выполняется **демо-инициализация**: создаются счета, базовые категории и несколько тестовых операций.  
- Путь к данным определяется относительно каталога запуска приложения (`AppContext.BaseDirectory`).

---

## Требования

- **.NET SDK 8.0+** (подойдёт и 7.0 при смене TargetFramework).  
- ОС: Windows / Linux / macOS.  
- Терминал с кодировкой UTF-8 (приложение выставляет `Console.Input/OutputEncoding = UTF8`).

Проверка наличия SDK:
```bash
dotnet --info
```

---

## Сборка и запуск

> Если у вас уже есть файл проекта (`*.csproj`) — просто выполните `dotnet run` в каталоге проекта.

### Вариант A. Быстрый старт (без существующего проекта)
1) Создайте папку проекта и поместите туда `Program.cs` из репозитория.  
2) Создайте файл проекта `FinanceApp.csproj`:
```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <OutputType>Exe</OutputType>
    <TargetFramework>net8.0</TargetFramework>
    <Nullable>enable</Nullable>
    <ImplicitUsings>enable</ImplicitUsings>
  </PropertyGroup>
  <ItemGroup>
    <PackageReference Include="Microsoft.Extensions.DependencyInjection" Version="8.0.0" />
  </ItemGroup>
</Project>
```
3) Выполните:
```bash
dotnet restore
dotnet run
```

### Вариант B. Через шаблон
```bash
dotnet new console -n FinanceApp
cd FinanceApp
# Замените созданный Program.cs на тот, что в репозитории
dotnet add package Microsoft.Extensions.DependencyInjection --version 8.0.0
dotnet run
```

После запуска появится меню. Данные будут записываться в `./data`.

---

## Меню приложения

При запуске вы увидите пункты (регистр символов не важен):

```
=== MENU ===
1) Показать счета
2) Показать операции (30 дней)
3) Добавить доход
4) Добавить расход
5) Перевод между счетами
6) Аналитика за период
7) Экспорт CSV/JSON/YAML
8) Сгенерировать тестовые операции
9) Очистить данные ./data
E) Редактировать операцию
R) Пересчитать балансы (по операциям)
T) Переключить формат сумм (₽ <-> N2 RUB)
0) Выход
```

**Коротко:**
- **1 — Счета:** таблица счетов с балансами.  
- **2 — Операции (30 дней):** последние операции.  
- **3 — Доход:** выбрать счёт и категорию *дохода*, ввести сумму и описание.  
- **4 — Расход:** аналогично для *расходных* категорий.  
- **5 — Перевод:** выбрать счёт-источник и счёт-получатель, затем сумму.  
- **6 — Аналитика:** введите даты `yyyy-MM-dd` → сводка + группировка по категориям.  
- **7 — Экспорт:** создаст `./data/export.csv`, `./data/export.json`, `./data/export.yaml`.  
- **8 — Генерация:** добавить N тестовых операций (например, 50).  
- **9 — Очистка:** полностью очищает папку `./data`.  
- **E — Редактирование операции:** из последних 30 дней. Поля можно пропускать, чтобы оставить без изменений.  
- **R — Пересчитать балансы:** по списку операций (начальные суммы счетов не учитываются).  
- **T — Формат сумм:** переключение `₽` ↔︎ `N2 RUB`.  
- **0 — Выход.**

---

## Экспорт данных

Пункт **7** меню сохранит три файла в `./data`:

- `export.csv` — столбцы: `type,account,category,amount,date(yyyy-MM-dd),description`  
- `export.json` — массив объектов с полями аналогичного смысла  
- `export.yaml` — список элементов в простом YAML-формате

> Импортёры для CSV/JSON/YAML реализованы (как «шаблонный метод»), но в меню импорт **не выведен**. При необходимости его легко добавить по аналогии с экспортом.

---

## Служебные действия

- **Демо-инициализация:** при первом запуске, если папка `./data` пуста, автоматически создаются 2 счёта, базовые категории и несколько операций.  
- **Измерение производительности:** операции фасадов обёрнуты в профайлер, время выполнения выводится в консоль (декоратор/прокси).

---

## Советы по проверке

1. Запустите приложение: `dotnet run` — убедитесь, что появилась папка `./data`.  
2. Добавьте 2–3 дохода и 2–3 расхода в разные категории.  
3. Посмотрите **Аналитику за период** (например, за последние 7 дней).  
4. Сделайте **Экспорт** и откройте `./data/export.json` любым редактором.  
5. Попробуйте **Редактирование** операции через пункт `E`.  
6. Нажмите `R`, чтобы пересчитать балансы из операций, и сравните со значениями до пересчёта.  
7. Переключите формат сумм клавишей `T` и убедитесь, что форматирование меняется в выводе.

---

## Лицензия

Вы можете свободно использовать и изменять код в учебных целях.

---

## Использованные паттерны и DI

В проекте намеренно продемонстрированы несколько классических паттернов проектирования (GoF) и DI-контейнер .NET.

### DI-контейнер (.NET Dependency Injection)
- Используется `Microsoft.Extensions.DependencyInjection`.
- Регистрация сервисов и репозиториев выполняется в методе инициализации (например, `BuildServices()`), затем создаётся `ServiceProvider`, а зависимости получаютcя через конструкторы.

### GoF паттерны

**1) Facade (Фасад)**  
`BankAccountFacade`, `CategoryFacade`, `OperationFacade`, `AnalyticsFacade` — упрощённые входные точки к подсистемам (счета, категории, операции, аналитика), скрывающие детали репозиториев и сервисов.

**2) Factory (Фабрика)**  
`IDomainFactory` / `DomainFactory` создают доменные сущности (`BankAccount`, `Category`, `Operation`) с валидацией входных данных (суммы, даты, названия и т. п.).

**3) Repository (enterprise pattern)**  
Обобщённый `IRepository<T>` и файловые реализации (`FileRepositoryBase`, `BankAccountFileRepository`, `CategoryFileRepository`, `OperationFileRepository`) инкапсулируют доступ к данным и изоляцию хранилища (`./data`).

**4) Proxy (Прокси)**  
`CachingRepositoryProxy<T>` и специализированные прокси добавляют кеширование поверх реального репозитория без изменения его кода.

**5) Command (Команда)**  
`ICommand` + конкретные команды (`AddIncomeCommand`, `AddExpenseCommand`, `TransferCommand`) инкапсулируют пользовательские операции (ввод, валидация, выполнение) в отдельные объекты команд.

**6) Decorator (Декоратор)**  
`TimedCommandDecorator` оборачивает команды и добавляет сквозное поведение (профилирование/тайминг выполнения) без изменения их кода.

**7) Template Method (Шаблонный метод)**  
Базовый `DataImporter` определяет общий алгоритм импорта, а реализации (`CsvImporter`, `JsonImporter`, `YamlImporter`) переопределяют шаги парсинга/разбора.

**8) Visitor (Посетитель)**  
Экспорт реализован через посетителя: `IExportVisitor` + `CsvExportVisitor` / `JsonExportVisitor` / `YamlExportVisitor`. Модель передаёт себя посетителю через `Accept(visitor)`, а формат вывода выбирается реализацией визитора.

### SOLID/GRASP кратко
- **SRP:** UI (консоль/меню), доменные модели, репозитории, фасады и сервисы разделены по ролям.  
- **OCP/DIP:** новые форматы импорта/экспорта и альтернативные хранилища добавляются через новые реализации интерфейсов; зависимости направлены на абстракции (`IRepository<T>`, `ICommand`, `IExportVisitor`, `IDataImporter`).

